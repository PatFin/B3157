B3153 
Samuel Toko
Patrick Finnerty

---------------- Etape 1 -------------------

Manque : Champ e-mail dans infos

---------------- XPath -------------------

1) Les auteurs de la mise en forme
	//infos/mise_en_forme_par/auteur

Etape 3:
=======
2) Les paragraphes de narration 
	//corps/paragr[@type='narration']

3) Les phrases en français
 	//corps/paragr/phrase[@langue='fr']

4) La troisième phrase de chaque paragraphe
	//corps/paragr/phrase[position()=3]

5) La neuvième phrase du texte (pensez à utiliser les parenthèses)
	(//corps/paragr/phrase)[position()=9]

6) Les phrases commençant par "Je" 
	//corps/paragr/phrase[starts-with(.,"Je")]

7) Listez les types des paragraphes du texte (sans doublons) 
	//corps/paragr[not(@type=preceding-sibling::paragr/@type)]/@type


---------------- XQuery -------------------

1. Retournez les phrases en français triés en ordre alphabétique

<phrasesFr>
{
  for $p in //phrase
  order by $p
  where $p/@langue = "fr"
  return $p
}
</phrasesFr>


**** Elements de réponse ****

<phrasesFr>
  <phrase locuteur="Narrateur" modalite="declarative" langue="fr">Alors j'ai dessiné.</phrase>
  <phrase locuteur="Narrateur" modalite="declarative" langue="fr">Alors vous imaginez ma surprise, au levé du jour, quand une drôle de petite voix m'a réveillé.</phrase>
  <phrase locuteur="Narrateur" modalite="declarative" langue="fr">Alors, faute de patience, comme j'avais hate de commencer le démontage de mon moteur, je griffonnai ce dessin-ci.</phrase>



2. Retournez les phrases françaises contenant le mot "mouton"

<phrasesFrMouton>
{
  for $p in //phrase
  order by $p
  where $p/@langue = "fr"
        and contains( $p, 'mouton')
  return $p
}
</phrasesFrMouton>


**** Elements de réponse ****

<phrasesFrMouton>
  <phrase locuteur="LePetitPrince" modalite="impérative" langue="fr">Ca ne fait rien. Dessine-moi un mouton.</phrase>
  <phrase locuteur="Narrateur" modalite="declarative" langue="fr">Comme je n'avais jamais dessiné un mouton je refis, pour lui, un des deux seuls dessins dont j'étais capable.</phrase>
  <phrase locuteur="LePetitPrince" modalite="interrogative" langue="fr">Crois-tu qu'il faille beaucoup d'herbe à ce mouton?</phrase>

3. Pour chaque paragraphe: donnez son type, le nombre de phrases qui la compose, les modalités de ces phrases (sans répétition) ainsi que les locuteurs. (allez-y étape par étape). Astuce : pour avoir les valeurs uniques des modalités, utilisez la fonction distinct-values

<paragraphe2>
{
  for $p in //paragr
  return 
    <paragr>
      <type> 
        {$p/@type/(concat(name(.),"=",.))} 
      </type> 
      <NombrePhrases> 
        {count($p/phrase)} 
      </NombrePhrases>
      <modalites>
        {distinct-values($p/phrase/@modalite/(concat(name(.),"=",.)))}
       </modalites>
      <locuteur> 
        {distinct-values($p/phrase/@locuteur/(concat(name(.),"=",.)))} 
      </locuteur>
    </paragr>
}
</paragraphe2>


**** Elements de réponse ****

<paragraphe2>
  <paragr>
    <type>type=narration</type>
    <NombrePhrases>7</NombrePhrases>
    <modalites>modalite=declarative</modalites>
    <locuteur>locuteur=Narrateur</locuteur>
  </paragr>
  <paragr>
    <type>type=narration</type>
    <NombrePhrases>7</NombrePhrases>
    <modalites>modalite=declarative</modalites>
    <locuteur>locuteur=Narrateur</locuteur>
  </paragr>
  <paragr>

4. Afficher la version française seulement (respectez la structure en paragraphes)


<vf2>{
  for $p in //paragr
  return
  <paragraphe>
  {data($p/phrase[@langue = "fr"])}
  </paragraphe>
}</vf2>


**** Elements de réponse ****

<vf2>
  <paragraphe>J'ai ainsi vécu seul, sans personne avec qui parler véritablement, jusqu'à une panne dans le désert du Sahara, il y a six ans. Quelque chose s'était cassé dans mon moteur, et comme je n'avais avec moi ni mécanicien, ni passagers, je me préparai à essayer de réussir, tout seul, une réparation difficile. C'était pour moi une question de vie ou de mort. J'avais à peine de l'eau à boire pour huit jours.</paragraphe>


5. Afficher uniquement les deuxièmes phrases des paragraphes de la version française

<vf2phrase>{
  for $p in //paragr
  where $p/phrase[@langue = "fr"]
  return
    <paragraphe>
      {data($p/phrase[position()=1])}
      {data($p/phrase[position()=2]) }
    </paragraphe>
}</vf2phrase>


**** Elements de réponse ****

<vf2phrase>
  <paragraphe>J'ai ainsi vécu seul, sans personne avec qui parler véritablement, jusqu'à une panne dans le désert du Sahara, il y a six ans.Quelque chose s'était cassé dans mon moteur, et comme je n'avais avec moi ni mécanicien, ni passagers, je me préparai à essayer de réussir, tout seul, une réparation difficile.</paragraphe>


6. Afficher seulement les dialogues en français du narrateur

<vf3>{
      for $phrase in //paragr[@type="dialogue"]/phrase
      where  $phrase/@langue ="fr"
      and $phrase/@locuteur="Narrateur"
      return 
      <phrase>
      { data($phrase) }
      </phrase>
}</vf3>


**** Elements de réponse ****

<vf3>
  <phrase>Hein!</phrase>
  <phrase>Mais qu'est-ce que tu fais là?</phrase>
  <phrase>Ca c'est la caisse.</phrase>
  <phrase>Le mouton que tu veux est dedans.</phrase>
  <phrase>Pourquoi?</phrase>
  <phrase>Ca suffira sûrement.</phrase>
  <phrase>Je t'ai donné un tout petit mouton.</phrase>
</vf3>


7. Afficher toutes les phrases du Petit Prince en français qui comporte le mot "mouton" ainsi que le nombre de ces phrases

<vf4 nb="{count(//paragr[@type='dialogue']/phrase[@langue ='fr' 
      and @locuteur='LePetitPrince' and contains( ., 'mouton')])}">{
      for $phrase in //paragr[@type="dialogue"]/phrase
      where  $phrase/@langue ="fr"
      and $phrase/@locuteur="LePetitPrince"
      and contains( $phrase, 'mouton')
      return 
      <phrase>
      { data($phrase) }
      </phrase>
  
}</vf4>


**** Elements de réponse ****

<vf4 nb="9">
  <phrase>S'il vous plaît... dessine-moi un mouton!</phrase>
  <phrase>Dessine-moi un mouton...</phrase>
  <phrase>S'il vous plaît... dessine-moi un mouton...</phrase>
  <phrase>Ca ne fait rien. Dessine-moi un mouton.</phrase>
  <phrase>J'ai besoin d'un mouton.</phrase>
  <phrase>Dessine-moi un mouton.</phrase>
  <phrase>Tu vois bien... ce n'est pas un mouton, c'est un bélier.</phrase>
  <phrase>Je veux un mouton qui vive longtemps.</phrase>
  <phrase>Crois-tu qu'il faille beaucoup d'herbe à ce mouton?</phrase>
</vf4>
